#!/bin/bash
sudo yum install -y epel-release && sudo yum install -y nginx mod_ssl
sudo mkdir /etc/nginx/ssl
for i in {1,2}; do sudo mkdir /usr/share/nginx/kalyujniy-s$i.local && echo "kalyujniy-s$i test suite" | sudo tee /usr/share/nginx/kalyujniy-s$i.local/index.html; echo -en "server {\n        listen 80;\n        root /usr/share/nginx/kalyujniy-s$i.local;\n        index index.html index.htm;\n        server_name kalyujniy-s$i.local;\n        try_files \$uri \$uri/ = 404;\n}\n\nserver {\n        listen 443 ssl;\n        root /usr/share/nginx/kalyujniy-s$i.local;\n        index index.html index.htm;\n        server_name kalyujniy-s$i.local;\n        ssl_certificate /etc/nginx/ssl/kalyujniy-s$i.crt;\n        ssl_certificate_key /etc/nginx/ssl/kalyujniy-s$i.key;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_ciphers HIGH:!aNULL:!MD5;\n}\n" | sudo tee /etc/nginx/conf.d/kalyujniy-s$i.local.conf; echo -e "\n\n\n\n\n\n" | openssl req -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/nginx/ssl/kalyujniy-s$i.key -out /etc/nginx/ssl/kalyujniy-s$i.crt; done
sudo systemctl enable nginx --now
sudo firewall-cmd --zone=public --permanent --add-service=http --add-service=https
sudo firewall-cmd --reload